---
layout: post
title: "Expressë¡œ ì„œë²„ êµ¬ì„±í•˜ê¸° ( ë¯¸ë“¤ì›¨ì–´ ) - 9"
subtitle: "Express MiddleWareì— ëŒ€í•´ ì•Œì•„ë³´ì"
date: 2021-01-05 21:00:00
author: "Kyun2da"
header-style: text
tags:
  - ì„œë²„
  - Node.js
  - Express
# 0ï¸âƒ£ 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£ 4ï¸âƒ£ 5ï¸âƒ£ 6ï¸âƒ£ 7ï¸âƒ£ 8ï¸âƒ£ 9ï¸âƒ£ ğŸ”Ÿ
---

## 1ï¸âƒ£ ì„œë¡ 

ì•ˆë…•í•˜ì„¸ìš” ì˜¤ëŠ˜ì€ Expressì˜ ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©ë²•ì— ëŒ€í•´ ìì„¸í•˜ê²Œ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³´ë ¤ê³  í•©ë‹ˆë‹¤.

ë¨¼ì € ë¯¸ë“¤ì›¨ì–´ê°€ ë¬´ì—‡ì¸ì§€ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì¸ì§€ì— ëŒ€í•´ ì•Œì•„ë³´ê³  ì¢…ë¥˜ì™€ ê°ê°ì˜ ì‚¬ìš©ë²•ë“¤ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ë³¸ í¬ìŠ¤íŒ…ì€ [ê³µì‹ ë¬¸ì„œ](https://expressjs.com/en/guide/writing-middleware.html)ë¥¼ ë³´ê³  ì œê°€ ë³µìŠµí•  ë•Œ ë³´ê¸° ì¢‹ê²Œ ë§Œë“  í¬ìŠ¤íŒ…ì…ë‹ˆë‹¤. ì¢€ë” ì „ë¬¸í™”ëœ ê¸€ì„ ì½ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ì¡°í•´ ì£¼ì„¸ìš”.

ê·¸ëŸ¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

## 2ï¸âƒ£ ë¯¸ë“¤ì›¨ì–´ë€?

ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ìš”ì²­-ì‘ë‹µ ì‚¬ì´í´ ë™ì•ˆ (req)ìš”ì²­ ê°ì²´, (res)ì‘ë‹µ ê°ì²´, next() í•¨ìˆ˜ì— ëŒ€í•œ ì—‘ì„¸ìŠ¤ ê¶Œí•œì„ ê°–ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

ì¦‰, ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ëŠ” ìš”ì²­ì´ ì˜¤ë©´ ì‘ë‹µì„ í•˜ê¸°ì „ì— ê±°ì³ê°€ëŠ” í•¨ìˆ˜ë¼ê³  ë³´ì‹œë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ ìƒì†Œí•œ í•¨ìˆ˜ê°€ next()ì¼í…ë°ìš”.

ì´ í•¨ìˆ˜ëŠ” ìµìŠ¤í”„ë ˆìŠ¤ ë¼ìš°í„° ì•ˆì˜ í•¨ìˆ˜ë¡œì¨ í˜¸ì¶œë  ë•Œ í˜„ì¬ ë¯¸ë“¤ì›¨ì–´ì— ì´ì–´ ë¯¸ë“¤ì›¨ì–´ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

## 3ï¸âƒ£ ë¯¸ë“¤ì›¨ì–´ ì˜ˆì‹œ

ê°„ë‹¨í•œ ë¯¸ë“¤ì›¨ì–´ myLogger í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```js
var express = require("express");
var app = express();

var myLogger = function (req, res, next) {
  console.log("LOGGED");
  next();
};

app.use(myLogger);

app.get("/", function (req, res) {
  res.send("Hello World!");
});

app.listen(3000);
```

ìœ„ì˜ ì½”ë“œì²˜ëŸ¼ ì“°ê³  `/` ê²½ë¡œë¡œ ì ‘ì†í•œë‹¤ë©´ ë¨¼ì € app.use()ë¥¼ í†µí•´ myLoggerí•¨ìˆ˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

ê·¸ í›„ ì„±ê³µì ìœ¼ë¡œ myLogger í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ í›„ app.get('/') í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.

ì´ ë•Œ ì£¼ì˜í•´ì•¼í• ì ì€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì“¸ ë•ŒëŠ” ë§ˆì§€ë§‰ì— next()ê°€ ë“¤ì–´ê°€ì•¼í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

## 4ï¸âƒ£ Express ë¯¸ë“¤ì›¨ì–´ ì¢…ë¥˜

Express ë¯¸ë“¤ì›¨ì–´ ì¢…ë¥˜ëŠ” í¬ê²Œ 5ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

- Application-level middleware
- Router-level middleware
- Error-handling middleware
- Built-in middleware
- Third-party middleware

í¬ê²Œ ì´ë ‡ê²Œ ë‚˜ëˆŒ ìˆ˜ ìˆëŠ”ë°ìš” ê·¸ëŸ¼ ì´ì œ í•˜ë‚˜í•˜ë‚˜ ì‚´í´ë³´ë©° ê°ê° ì–´ë–¤ ì¢…ë¥˜ì¸ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

## 5ï¸âƒ£ Application-level middleware

app.use() ì™€ app.METHOD(ì—¬ê¸°ì„œ METHODëŠ” GET, PUT, POSTë“±ì˜ HTTP ë©”ì„œë“œë¥¼ ì˜ë¯¸)í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì•±ì— ë°”ì¸ë”©í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

```js
app.get("/user/:id", function (req, res, next) {
  res.send("USER");
});
```

ê°€ì¥ ê°„ë‹¨í•œ ì˜ˆë¡œ ìœ„ì™€ ê°™ì´ ë¼ìš°íŒ…í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

## 6ï¸âƒ£ Router-level middleware

router-level ë¯¸ë“¤ì›¨ì–´ë˜í•œ `express.Router()` ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ”ê²ƒ ë¹¼ê³ ëŠ” application-level ë¯¸ë“¤ì›¨ì–´ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

express.Router()ëŠ” ë¼ìš°í„°ë¥¼ ëª¨ë“ˆí™”í• ë•Œ ë§¤ìš° ìœ ìš©í•œ ê¸°ëŠ¥ì´ë‹¤.

ë§Œì•½ users ë¼ëŠ” URIì•„ë˜ ë˜ë‹¤ë¥¸ URIë¥¼ ì—¬ëŸ¬ê°œ ì‘ì„±í•˜ê³  ì‹¶ì„ë• ë‹¤ìŒê³¼ ê°™ì´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì“¸ ìˆ˜ ìˆë‹¤.

```js
app.use("/users", require("./routes/users"));
```

ê·¸ë¦¬ê³  ìƒˆë¡œ íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ ë¼ìš°íŒ…ì„ í•´ì£¼ì–´ ëª¨ë“ˆí™”ë¥¼ í•  ìˆ˜ ìˆë‹¤.

```js
var express = require("express");
var router = express.Router();

router.get("/", function (req, res, next) {
  res.send("ìœ ì € ë¦¬ìŠ¤íŠ¸");
});

router.get("/:id", function (req, res, next) {
  res.send("íŠ¹ì • ìœ ì € ì•„ì´ë””: " + req.params.id);
});

router.post("/", function (req, res, next) {
  res.send("ìœ ì € ì´ë¦„ ë“±ë¡: " + req.body.name);
});

router.put("/:id", function (req, res, next) {
  res.send("ìœ ì € ì´ë¦„ ìˆ˜ì •:" + req.body.name);
});

router.delete("/:id", function (req, res, next) {
  res.send("ìœ ì € ì´ë¦„ ì‚­ì œ" + req.params.id);
});

module.exports = router;
```

## 7ï¸âƒ£ Error-handling middleware

ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´ëŠ” í•­ìƒ 4ê°œì˜ íŒŒë¼ë¯¸í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ê·¸ë˜ì•¼ ì˜¤ë¥˜ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ë¡œ ì‹ë³„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```js
app.use(function (err, req, res, next) {
  console.error(err.stack);
  res.status(500).send("Something broke!");
});
```

ì—ëŸ¬ í•¸ë“¤ë§ì€ ë‹¤ìŒì— ì¶”ê°€ì ìœ¼ë¡œ í¬ìŠ¤íŒ… í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

## 8ï¸âƒ£ Built-in middleware

ì´ë¯¸ ë‚´ì¥ë˜ì–´ìˆëŠ” ë¯¸ë“¤ì›¨ì–´ëŠ” 4.x ë²„ì „ ë¶€í„° ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- [express.static](https://expressjs.com/en/4x/api.html#express.static) ì€ ì •ì íŒŒì¼ì„ ì œê³µí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
- [express.json](https://expressjs.com/en/4x/api.html#express.json) ì€ ìš”ì²­ì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
- [express.urlencoded](https://expressjs.com/en/4x/api.html#express.urlencoded) ì€ URL ì¸ì½”ë”© í˜ì´ë¡œë“œë¡œ ìˆ˜ì‹  ìš”ì²­ì„ êµ¬ë¬¸ ë¶„ì„í•©ë‹ˆë‹¤.

## 9ï¸âƒ£ Third-party middleware

ë‹¤ë¥¸ ì¨ë“œíŒŒí‹° ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ Express ì•±ì— ì¶”ê°€í•˜ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ì¿ í‚¤íŒŒì„œ ê°™ì€ ë¯¸ë“¤ì›¨ì–´ê°€ ìˆìŠµë‹ˆë‹¤.

```bash
$ npm install cookie-parser
```

```js
var express = require("express");
var app = express();
var cookieParser = require("cookie-parser");

// ì¿ í‚¤ íŒŒì„œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
app.use(cookieParser());
```

## ğŸ”Ÿ ë§ˆì¹˜ë©°..

ì˜¤ëŠ˜ì€ ë¯¸ë“¤ì›¨ì–´ì˜ ëœ»ê³¼ ë¯¸ë“¤ì›¨ì–´ì˜ ì¢…ë¥˜ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.

ë‹¤ìŒ ì‹œê°„ì—” ì—ëŸ¬ í•¸ë“¤ë§ ë°©ë²•ì„ ì¢€ë” ìì„¸í•˜ê²Œ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ™
